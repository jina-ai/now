jtype: Flow
with:
  name: nowapi
  port_expose: 8080
  cors: True
executors:
  - name: encoder_music
    uses: ${{ ENV.ENCODER_NAME }}
    uses_with:
      hop_size_in_sec: 2
    resources:
      memory: 8G
    env:
      JINA_LOG_LEVEL: DEBUG
  - name: linear_head
    uses: ${{ ENV.LINEAR_HEAD_NAME }}
    uses_with:
      finetune_layer_size: ${{ ENV.FINETUNE_LAYER_SIZE }}
      pre_trained_embedding_size: ${{ ENV.PRE_TRAINED_EMBEDDINGS_SIZE }}
    env:
      JINA_LOG_LEVEL: DEBUG
  - name: indexer
    uses: jinahub+docker://MusicRecommendationIndexer:e0b75cc6569bd73cee76e1161a433b9d/v0.0.5
    env:
      JINA_LOG_LEVEL: DEBUG